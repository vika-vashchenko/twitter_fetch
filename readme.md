# Twitter Fetcher

## Описание проекта
Программа Twitter Fetcher предназначена для автоматического сбора твитов из Twitter (X) по указанным пользователям. Данные сохраняются либо в локальные JSON-файлы, либо в базу данных MongoDB.

## Основные функции
- Автоматическая загрузка новых твитов с использованием since_id (чтобы не загружать дубликаты).
- Возможность сохранения данных в MongoDB или JSON-файлы.
- Регулярное обновление данных с определённым интервалом времени.
- Ведение логов всех действий.
- Гибкая настройка через файл config.json.

---

## Установка и запуск
### 1. Установите необходимые зависимости
Для работы программы требуется Python 3.8+ и несколько зависимостей. Установите их командой:

pip install -r requirements.txt

### 2. Настройка конфигурации
Перед запуском программы необходимо настроить файл config.json.

Пример config.json:
{
    "execution_interval_ms": 60000,
    "x_users_file_path": "x_users.json",
    "output_folder_path": "posts_db",
    "log_file_path": "logs/x_posts.log",
    "max_results": 100,
    "timestamp_format": "%Y%m%d%H%M%S%f",
    "use_mongodb": true,
    "mongodb_uri": "mongodb://admin:dbadmin@localhost:27017/",
    "mongodb_db_name": "twitter_data"
}

### 3. Запуск MongoDB (если используется)
Если вы хотите использовать MongoDB, запустите её через Docker:
docker-compose up -d

### 4. Запуск программы
После настройки запустите скрипт:
python main.py

---

## Как работает программа
### 1. Получение списка пользователей
Программа загружает список пользователей из x_users.json или базы данных MongoDB. Пример x_users.json:
{
    "users": [
        {"user_name": "@elonmusk", "last_refresh": "2024-07-19T11:55:01.112Z", "since_id": "1234567890"},
        {"user_name": "@BillGates", "last_refresh": "2024-07-19T11:55:01.112Z", "since_id": "0987654321"}
    ]
}

### 2. Запрос к Twitter API
Используя tweepy, программа отправляет запрос в Twitter API для каждого пользователя, запрашивая твиты, опубликованные после since_id.

### 3. Обработка и сохранение данных
- Если используется MongoDB: новые твиты добавляются в базу данных в коллекцию raw_data.
- Если MongoDB не используется: новые твиты добавляются в конец JSON-файла в папке posts_db.

Структура сохранённых данных:
{
    "user_name": "@elonmusk",
    "since_id": "9876543210",
    "post_list": [
        {"id": "9876543210", "text": "Новый твит!"},
        {"id": "9876543211", "text": "Ещё один твит!"}
    ]
}

### 4. Обновление since_id
После успешного получения новых твитов обновляется значение since_id, чтобы в следующий раз загружались только новые записи.

### 5. Логирование
Программа ведёт логирование всех действий в файле logs/x_posts.log, включая ошибки, запросы и паузы при превышении лимитов API.

---

## Возможные ошибки и их решения
### Ошибка аутентификации MongoDB
pymongo.errors.OperationFailure: Command find requires authentication
Решение: Убедитесь, что пользователь admin создан в MongoDB. Запустите:
docker exec -it mongo_container mongo -u admin -p dbadmin --authenticationDatabase admin

### Twitter API возвращает пустые данные
Если программа не получает новых твитов, убедитесь, что:
- Указан корректный since_id (не слишком старый).
- Ваш API-ключ Twitter работает.
- У пользователя действительно есть новые твиты.

### Превышен лимит API Twitter (429 Too Many Requests)
Программа автоматически ждёт, если Twitter ограничивает частоту запросов. В логах появится запись:
Rate limit exceeded. Waiting for X seconds before retrying..